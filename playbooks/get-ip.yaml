- name: üì° ‡∏î‡∏∂‡∏á Public IP ‡∏Ç‡∏≠‡∏á VM
  hosts: localhost
  connection: local
  gather_facts: no

  vars_files:
    - ../config/config-dev.yaml

  tasks:
    - name: üì• ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Public IP ‡∏à‡∏≤‡∏Å Azure
      azure.azcollection.azure_rm_publicipaddress_info:
        resource_group: "{{ resource_group }}"
        name: "{{ pip_name }}"
        auth_source: env
      register: ip_info

    - name: ‚ùå Fail ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö IP
      fail:
        msg: "‡πÑ‡∏°‡πà‡∏û‡∏ö Public IP ‡∏Ç‡∏≠‡∏á VM"
      when: ip_info.azure_publicipaddresses is not defined or ip_info.azure_publicipaddresses | length == 0

    - name: üìù ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Public IP ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå
      copy:
        content: "{{ ip_info.azure_publicipaddresses[0].ip_address }}"
        dest: "~/ip.txt"
