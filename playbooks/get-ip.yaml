- hosts: localhost
  connection: local
  vars:
    ansible_python_interpreter: /home/boho/ansible-env/bin/python3
  tasks:
    - name: 🔁 ลบไฟล์ ip.txt เดิม (ถ้ามี)
      file:
        path: ~/ip.txt
        state: absent

    - name: 📥 ดึง Public IP ของ VM
      azure.azcollection.azure_rm_publicipaddress_info:
        resource_group: "{{ resource_group }}"
        name: "{{ pip_name }}"
      register: ip_info

    - name: 🔍 แสดงค่า IP ที่ได้จาก Azure
      debug:
        msg: "IP Address: {{ ip_info.azure_publicipaddresses[0].ip_address | default('N/A') }}"

    - name: 📝 เขียน Public IP ลงไฟล์
      copy:
        content: "{{ ip_info.azure_publicipaddresses[0].ip_address | default('') }}"
        dest: ~/ip.txt
